
default:
  artifacts:
    reports:
      junit: Test/TestResults/TestResults.xml

windows-winpcap:
  tags:
  - shared-windows
  script:
  - choco install -y winpcap
  # No bash support
  - dotnet test --framework net5.0 --logger:junit --test-adapter-path:. --filter "TestCategory!=Timestamp"
  # No code coverage yet, it has to be done after the tokens are configured

ubuntu-20.04:
  image: mcr.microsoft.com/dotnet/sdk:5.0-focal
  script:
  - apt-get update
  - apt-get install -y build-essential
  - bash scripts/install-libpcap.sh
  - bash scripts/test.sh

ubuntu-20.04-arm64:
  image: mcr.microsoft.com/dotnet/sdk:5.0-focal-arm64v8
  script:
  - apt-get update
  - apt-get install -y libpcap0.8
  # ARM is slow, no performance tests
  - bash scripts/test.sh --filter "TestCategory!=Performance"
